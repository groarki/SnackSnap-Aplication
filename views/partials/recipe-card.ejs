<div class="card h-100 recipe-card" data-recipe-id="<%= recipe.id %>">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span class="badge bg-primary">
      <i class="fas fa-tag me-1"></i>
      <%= recipe.category %>
    </span>
    <div class="recipe-rating">
      <i class="fas fa-star text-warning"></i>
      <span class="fw-bold">
        <%= recipe.getAverageRating ? recipe.getAverageRating() : '0.0' %>
      </span>
      <small class="text-muted ms-1">
        (<%= recipe.ratings ? recipe.ratings.length : 0 %>)
      </small>
    </div>
  </div>

  <div class="card-body d-flex flex-column">
    <h5 class="card-title text-truncate" title="<%= recipe.name %>">
      <%= recipe.name %>
    </h5>

    <p class="card-text mb-2">
      <small class="text-muted">
        <i class="fas fa-user me-1"></i>
        <%= recipe.author %>
        <span class="ms-2">
          <i class="fas fa-clock me-1"></i>
          <%= new Date(recipe.createdAt).toLocaleDateString('pl-PL') %>
        </span>
      </small>
    </p>

    <div class="ingredients-preview flex-grow-1">
      <p class="card-text">
        <strong class="text-primary">
          <i class="fas fa-list-ul me-1"></i>
          Składniki:
        </strong>
      </p>
      <% if (recipe.ingredients && recipe.ingredients.length > 0) { %>
      <ul class="ingredient-preview list-unstyled small">
        <% recipe.ingredients.slice(0, 3).forEach(function(ingredient, index) {
        %>
        <li class="mb-1">
          <i class="fas fa-check text-success me-2"></i>
          <%= ingredient %>
        </li>
        <% }); %> <% if (recipe.ingredients.length > 3) { %>
        <li class="text-muted">
          ...i <%= recipe.ingredients.length - 3 %> więcej
        </li>
        <% } %>
      </ul>
      <% } else { %>
      <p class="text-muted small">Brak informacji o składnikach</p>
      <% } %>
    </div>

    <div class="recipe-quick-info mt-2">
      <div class="row text-center">
        <div class="col-4">
          <div class="quick-stat">
            <i class="fas fa-utensils text-primary"></i>
            <small class="d-block text-muted">
              <%= recipe.ingredients ? recipe.ingredients.length : 0 %>
              składników
            </small>
          </div>
        </div>
        <div class="col-4">
          <div class="quick-stat">
            <i class="fas fa-comments text-info"></i>
            <small class="d-block text-muted">
              <%= recipe.comments ? recipe.comments.length : 0 %> komentarzy
            </small>
          </div>
        </div>
        <div class="col-4">
          <div class="quick-stat">
            <i class="fas fa-heart text-danger"></i>
            <small class="d-block text-muted">
              <%= recipe.ratings ? recipe.ratings.length : 0 %> ocen
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if (typeof user !== 'undefined' && user && recipe.userId === user.id) { %>
  <div class="card-footer bg-light border-0">
    <div class="btn-group w-100 mb-2" role="group">
      <a
        href="/recipes/<%= recipe.id %>/edit"
        class="btn btn-warning btn-sm d-flex align-items-center justify-content-center"
        onclick="event.stopPropagation();"
        data-bs-toggle="tooltip"
        title="Edytuj przepis"
      >
        <i class="fas fa-edit me-1"></i>
        <span class="d-none d-md-inline">Edytuj</span>
      </a>
      <button
        type="button"
        class="btn btn-danger btn-sm d-flex align-items-center justify-content-center"
        onclick="event.stopPropagation(); deleteRecipe('<%= recipe.id %>', '<%= recipe.name %>')"
        data-bs-toggle="tooltip"
        title="Usuń przepis"
      >
        <i class="fas fa-trash me-1"></i>
        <span class="d-none d-md-inline">Usuń</span>
      </button>
    </div>
    <small class="text-muted d-block text-center">
      <i class="fas fa-mouse-pointer me-1"></i>
      Kliknij kartę, aby zobaczyć przepis
    </small>
  </div>
  <% } else { %>
  <div class="card-footer bg-light border-0 text-center">
    <small class="text-muted">
      <i class="fas fa-mouse-pointer me-1"></i>
      Kliknij kartę, aby zobaczyć przepis
    </small>
  </div>
  <% } %>

  <div class="recipe-loading d-none align-items-center justify-content-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Ładowanie...</span>
    </div>
  </div>
</div>
